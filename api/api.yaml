openapi: "3.0.0"
info:
  version: 1.0.0
  title: AmpLabs API
paths:
  /healthcheck:
    get:
      summary: Health check
      x-openapi-router-controller: app.controllers.auth_controller
      operationId: health_check
      tags:
        - Healthcheck
      responses:
        "200":
          description: Successfull
  /login:
    post:
      summary: Login (do login before trying any other request)
      x-openapi-router-controller: app.controllers.auth_controller
      operationId: login
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
              example:
                email: "test@test.com"

      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong
  /logout:
    get:
      summary: Logout, clears the cookies set
      x-openapi-router-controller: app.controllers.auth_controller
      operationId: logout
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
      tags:
        - Auth
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong
  /cells/{test}/meta:
    get:
      summary: Fetches metadata for all cells for the email logged in.
      x-openapi-router-controller: app.controllers.cell_metadata_controller
      operationId: get_cells
      tags:
        - Cell Meta
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: test
          in: path
          description: test type
          required: true
          style: simple
          explode: false
          schema:
            type: string
            enum: [cycle, abuse]
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong.
    patch:
      summary: Fetches metadata for all cells for the email logged in.
      x-openapi-router-controller: app.controllers.cell_metadata_controller
      operationId: update_cell_metadata
      tags:
        - Cell Meta
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: test
          in: path
          description: test type
          required: true
          style: simple
          explode: false
          schema:
            type: string
            enum: [cycle, abuse]
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong.
  /cells/{test}/metaWithId:
    get:
      summary: Fetches metadata for given cell id for the email logged in.
      x-openapi-router-controller: app.controllers.cell_metadata_controller
      operationId: get_cell_with_id
      tags:
        - Cell Meta
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell Id
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
        - name: test
          in: path
          description: test type
          required: true
          style: simple
          explode: false
          schema:
            type: string
            enum: [cycle, abuse]
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong.
    delete:
      summary: Delete all data for a cell from archive for the email logged in.
      x-openapi-router-controller: app.controllers.cell_metadata_controller
      operationId: delete_cell
      tags:
        - Cell Meta
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID of the resource to delete
          required: true
          style: form
          explode: true
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
      responses:
        "200":
          description: Successfull
        "500":
          description: Internal Server Error
  /cells/tests/{test}/meta:
    get:
      summary: Fetches test metadata of test.
      x-openapi-router-controller: app.controllers.test_metadata_controller
      operationId: get_testmeta
      tags:
        - Test Meta
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: test
          in: path
          description: Test Name of the resource to get
          required: true
          style: simple
          explode: false
          schema:
            type: string
            enum: [cycle, abuse]
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong
    patch:
      summary: Fetches test metadata of test.
      x-openapi-router-controller: app.controllers.test_metadata_controller
      operationId: update_test_metadata
      tags:
        - Test Meta
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: test
          in: path
          description: Test Name of the resource to get
          required: true
          style: simple
          explode: false
          schema:
            type: string
            enum: [cycle, abuse]
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong
  /cells/tests/{test}/metaWithId:
    get:
      summary: Fetches test metadata of testname for a cell id
      x-openapi-router-controller: app.controllers.test_metadata_controller
      operationId: get_testmeta_by_cell_id
      tags:
        - Test Meta
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID of the resource to get
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
        - name: test
          in: path
          description: Test Name of the resource to get
          required: true
          style: simple
          explode: false
          schema:
            type: string
            enum: [cycle, abuse]
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong
  /upload/cells/initialize:
    post:
      summary: Initialize upload file request (required to be sent before /upload/cells/{tester} request)
      description: |
        Data sent in this request will be used by the succeeding upload file request.

         **For uploading cycle test file following form fields are useed:**

         - Required
           - cell_id
           - file_count
           - test_type
         - Cell Metadata
           - anode
           - cathode
           - source
           - ah
           - form_factor
         - Test Metadata
           - temperature
           - soc_max
           - soc_min
           - crate_c
           - crate_d

         **For uploading abuse test file following form fields are useed:**

         - Required
           - cell_id
           - file_count
           - test_type
         - Cell Metadata
           - anode
           - cathode
           - source
           - ah
           - form_factor
         - Test Metadata
           - temperature
           - thickness
           - nail_speed
           - indentor
           - v_init

         **Note: Must be logged in before sending this request**
      x-openapi-router-controller: app.controllers.file_transfer_controller
      operationId: init_file_upload
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                cell_id:
                  type: string
                  nullable: false
                  example: SNL_18650_NMC_35C_0-100_0.5-1C_a
                file_count:
                  type: integer
                  enum: [1]
                  description: Number of files that will be sent in the upload request
                test_type:
                  type: string
                  enum: [cycle, abuse]
                anode:
                  type: string
                  example: Graphite
                cathode:
                  type: string
                  example: NMC
                source:
                  type: string
                  example: Commercial
                ah:
                  type: number
                  example: 3
                form_factor:
                  type: string
                  example: NA
                temperature:
                  type: number
                  example: 25
                soc_max:
                  type: number
                  example: 100
                soc_min:
                  type: number
                  example: 10
                crate_c:
                  type: number
                  example: 0.5
                crate_d:
                  type: number
                  example: 1
                thickness:
                  type: number
                  example: 7
                v_init:
                  type: number
                  example: 4.12
                indentor:
                  type: number
                  example: 6
                nail_speed:
                  type: number
                  example: 0.05
              required:
                - cell_id
                - file_count
                - test_type
      tags:
        - Upload
      responses:
        "200":
          description: Successfull response
        "500":
          description: Something went wrong
  /upload/cells/{tester}:
    post:
      summary: Upload test file
      x-openapi-router-controller: app.controllers.file_transfer_controller
      operationId: upload_file
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: tester
          in: path
          description: |
            If test_type sent in upload/initialize request is cycle then tester must be generic. For abuse it can be any of ornl/snl
            else
          required: true
          style: simple
          explode: false
          schema:
            type: string
            enum: ["generic", "ornl", "snl"]
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                cell_id:
                  description: similar to the cell_id sent in upload initialize request.
                  type: string
                  example: SNL_18650_NMC_35C_0-100_0.5-1C_a
                file:
                  type: string
              required:
                - cell_id
                - file
      tags:
        - Upload
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong

  /upload/cells/status:
    get:
      summary: Check upload status for the file sent via uplaod request.
      x-openapi-router-controller: app.controllers.status_check_controller
      operationId: get_status
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
      tags:
        - Upload
      responses:
        "200":
          description: Successfull response
        "500":
          description: Something went wrong
  /download/cells/cycle_timeseries:
    get:
      summary: Download Cycle timeseries csv file for a cell id.
      x-openapi-router-controller: app.controllers.file_transfer_controller
      operationId: download_cycle_timeseries
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID of the resource to get
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
      tags:
        - Download
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong
  /download/cells/abuse_timeseries:
    get:
      summary: Download Abuse timeseries csv file for a cell id.
      x-openapi-router-controller: app.controllers.file_transfer_controller
      operationId: download_abuse_timeseries
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID of the resource to get
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
      tags:
        - Download
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong
  /download/cells/cycle_data:
    get:
      summary: Download Cycle csv file for a cell id.
      x-openapi-router-controller: app.controllers.file_transfer_controller
      operationId: download_cycle_data
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID of the resource to get
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
      tags:
        - Download
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong
  /echarts/cycleQuantitiesByStep:
    get:
      summary: Fetches cycle quantities by step query results
      x-openapi-router-controller: app.controllers.echarts_controller
      operationId: get_cycle_quantities_by_step
      tags:
        - Echart - Get json data required for plotting
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
        - name: step
          in: query
          description: steps
          explode: true
          required: true
          style: form
          schema:
            type: integer
            example: 500
      responses:
        "200":
          description: Successfull response
        "500":
          description: Something went wrong
  /echarts/energyAndCapacityDecay:
    get:
      summary: Fetches energy and capacity decay query results
      x-openapi-router-controller: app.controllers.echarts_controller
      operationId: get_energy_and_capacity_decay
      tags:
        - Echart - Get json data required for plotting
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
      responses:
        "200":
          description: Successfull response
        "500":
          description: Something went wrong"
  /echarts/efficiency:
    get:
      summary: Fetches efficiency query results
      x-openapi-router-controller: app.controllers.echarts_controller
      operationId: get_efficiency
      tags:
        - Echart - Get json data required for plotting
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
      responses:
        "200":
          description: Successfull response
        "500":
          description: Something went wrong
  /echarts/compareByCycleTime:
    get:
      summary: Fetches comapre cycle voltage and current query results
      x-openapi-router-controller: app.controllers.echarts_controller
      operationId: get_compare_by_cycle_time
      tags:
        - Echart - Get json data required for plotting
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
      responses:
        "200":
          description: Successfull response
        "500":
          description: Something went wrong
  /echarts/forceAndDisplacement:
    get:
      summary: Fetches force and displacement query results
      x-openapi-router-controller: app.controllers.echarts_controller
      operationId: get_force_and_displacement
      tags:
        - Echart - Get json data required for plotting
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
        - name: sample
          in: query
          description: sample
          explode: true
          required: true
          style: form
          schema:
            type: integer
            items:
              type: integer
              example: 50
      responses:
        "200":
          description: Successfull response
        "500":
          description: Something went wrong
  /echarts/testTempratures:
    get:
      summary: Fetches test tempratures query results
      x-openapi-router-controller: app.controllers.echarts_controller
      operationId: get_test_tempratures
      tags:
        - Echart - Get json data required for plotting
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
        - name: sample
          in: query
          description: sample
          explode: true
          required: true
          style: form
          schema:
            type: integer
            items:
              type: integer
              example: 50
      responses:
        "200":
          description: Successfull response
        "500":
          description: Something went wrong
  /echarts/voltage:
    get:
      summary: Fetches voltage query results
      x-openapi-router-controller: app.controllers.echarts_controller
      operationId: get_voltage
      tags:
        - Echart - Get json data required for plotting
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
        - name: sample
          in: query
          description: sample
          explode: true
          required: true
          style: form
          schema:
            type: integer
            items:
              type: integer
              example: 50
      responses:
        "200":
          description: Successfull response
        "500":
          description: Something went wrong
  /download/cells/cycle_data_json:
    get:
      summary: Get cycle data in json format for a cell id.
      x-openapi-router-controller: app.controllers.file_transfer_controller
      operationId: get_cycle_data_json
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID of the resource to get
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
      tags:
        - Download
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong
  /download/cells/cycle_timeseries_json:
    get:
      summary: Get cycle timeseries data in json format for a cell id.
      x-openapi-router-controller: app.controllers.file_transfer_controller
      operationId: get_cycle_timeseries_json
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID of the resource to get
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
      tags:
        - Download
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong
  /download/cells/abuse_timeseries_json:
    get:
      summary: Get abuse timeseries data in json format for a cell id.
      x-openapi-router-controller: app.controllers.file_transfer_controller
      operationId: get_abuse_timeseries_json
      parameters:
        - name: userId
          in: cookie
          description: Email Id
          required: true
          schema:
            type: string
            format: email
            example: test@test.com
        - name: cell_id
          in: query
          description: Cell ID of the resource to get
          explode: true
          required: true
          style: form
          schema:
            type: array
            items:
              type: string
              example: SNL_18650_NMC_35C_0-100_0.5-1C_a
      tags:
        - Download
      responses:
        "200":
          description: Successfull
        "500":
          description: Something went wrong
  /ga/publish/finish/{tracker}:
    post:
      summary: "test api endpoint"
      x-openapi-router-controller: app.controllers.ga_controller
      operationId: finish
      tags:
        - Galvanalyser-Integration
      parameters:
        - name: tracker
          in: path
          description: Dataset ID of the resource to get from Galvanalyser
          required: true
          style: simple
          explode: false
          schema:
            type: string
      responses:
        "200":
          description: Finish
          headers:
            x-next:
              description: A link to the next page of responses
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  tracker:
                    type: string
                    example: "uuid_abc_123"
  /ga/publish/{dataset_id}:
    post:
      summary: Handler for Galvanalyser Publishing
      x-openapi-router-controller: app.controllers.ga_controller
      operationId: ga_publish
      tags:
        - Galvanalyser-Integration
      parameters:
        - name: dataset_id
          in: path
          description: Dataset ID of the resource to get from Galvanalyser
          required: true
          style: simple
          explode: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
              required:
                - token

      responses:
        "200":
          description: Publish
          headers:
            x-next:
              description: A link to the next page of responses
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  tracker:
                    type: string
                    example: "uuid_abc_123"
  /ga/publish/status/{tracker}:
    get:
      summary: Status Checker for Galvanalyser Publishing
      x-openapi-router-controller: app.controllers.ga_controller
      operationId: ga_publish_status
      tags:
        - Galvanalyser-Integration
      parameters:
        - name: tracker
          in: path
          description: status tracker
          required: true
          style: simple
          explode: false
          schema:
            type: string
      responses:
        "200":
          description: A paged array of cells
          headers:
            x-next:
              description: A link to the next page of responses
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  tracker:
                    type: string
                    example: "uuid_abc_123"
        default:
          description: unexpected error

tags:
  - name: Auth
  - name: Cell Meta
  - name: Test Meta
  - name: Upload
  - name: Download
  - name: Echart - Get json data required for plotting
  - name: Galvanalyser-Integration
  - name: Healthcheck

servers:
  - url: https://www.amplabs.ai
    variables: {}
